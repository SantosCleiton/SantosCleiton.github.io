<!DOCTYPE html>
<html>
  <head>
    <script src="https://static.safe2pay.dev/scripts/verify_3DS2.min.js"></script>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial, sans-serif;
      }
      form {
        display: flex;
        flex-direction: column;
        width: 300px;
        gap: 10px;
      }
      input, select, button {
        padding: 8px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <form>
      <h2>Exemplo 3DS</h2>

      <label for="txtCardAlias">Nome impresso no cartão</label>
      <input type="text" id="txtCardAlias" placeholder="Nome impresso no cartão" oninput="this.value = this.value.replace(/[^a-zA-ZÀ-ÿ\s]/g, '')" />

      <label for="txtCardNumber">Número do cartão</label>
      <input type="text" id="txtCardNumber" placeholder="Número do cartão" maxlength="19" />

      <label for="txtAmount">Valor da compra</label>
      <input type="text" id="txtAmount" placeholder="Digite o valor" />

      <label for="drpInstallments">Parcelas</label>
      <select id="drpInstallments">
        <option value="01">1x</option>
        <option value="02">2x</option>
        <option value="03">3x</option>
        <option value="04">4x</option>
        <option value="05">5x</option>
        <option value="06">6x</option>
        <option value="07">7x</option>
        <option value="08">8x</option>
        <option value="09">9x</option>
        <option value="10">10x</option>
        <option value="11">11x</option>
        <option value="12">12x</option>
      </select>

      <label for="drpCardExpirationMonth">Mês de Vencimento</label>
      <select id="drpCardExpirationMonth">
        <option value="01">Janeiro</option>
        <option value="02">Fevereiro</option>
        <option value="03">Março</option>
        <option value="04">Abril</option>
        <option value="05">Maio</option>
        <option value="06">Junho</option>
        <option value="07">Julho</option>
        <option value="08">Agosto</option>
        <option value="09">Setembro</option>
        <option value="10">Outubro</option>
        <option value="11">Novembro</option>
        <option value="12">Dezembro</option>
      </select>

      <label for="drpCardExpirationYear">Ano de Vencimento</label>
      <select id="drpCardExpirationYear">
        <option value="25">2025</option>
        <option value="26">2026</option>
        <option value="27">2027</option>
        <option value="28">2028</option>
        <option value="29">2029</option>
        <option value="30">2030</option>
        <option value="31">2031</option>
        <option value="32">2032</option>
        <option value="33">2033</option>
        <option value="34">2034</option>
        <option value="35">2035</option>
      </select>

      <input id="btnSendOrder" value="Processar Pagamento" type="button" disabled />
    </form>

    <script>
      // Máscara para número do cartão (máx. 16 dígitos)
      document.getElementById('txtCardNumber').addEventListener('input', function(e) {
        let rawValue = e.target.value.replace(/\D/g, '').slice(0, 16);
        e.target.value = rawValue.replace(/(.{4})/g, '$1 ').trim();
      });

      Safe2Pay.Mpi.addEventListener("onReady", function() {
        document.getElementById("btnSendOrder").disabled = false;
      });

      var config = {
        IsEnabled: true,
        IsSandbox: true,
        IsDebug: true,
        IsChallengeSuppressed: false
      };

      document.getElementById("btnSendOrder").addEventListener("click", function() {
        let rawValue = document.getElementById('txtAmount').value;
        rawValue = rawValue.replace(/[^\d.,]/g, '').replace(',', '.');

        let amount = parseFloat(rawValue);
        if (isNaN(amount)) {
          alert("Valor inválido. Digite um número.");
          return;
        }

        let amountInCents = Math.round(amount * 100);
        Safe2Pay.Mpi.Init(config, amountInCents);

        let paymentObject = {
          currency: "BRL",
          installments: document.getElementById('drpInstallments').value,
          cardnumber: document.getElementById('txtCardNumber').value,
          cardexpirationmonth: document.getElementById('drpCardExpirationMonth').value,
          cardexpirationyear: document.getElementById('drpCardExpirationYear').value,
          cardalias: document.getElementById('txtCardAlias').value
        };

        Safe2Pay.Mpi.Checkout(paymentObject);
      });
    </script>
  </body>
</html>
